---
paths:
  - "test/**/*.go"
  - "testdata/**"
---

# test/ ディレクトリルール

統合テスト（integration）とエンドツーエンドテスト（E2E）を格納する。ユニットテストは各パッケージ内の `*_test.go` に配置し、ここには含めない。

## テストの分類

| 分類 | 場所 | 実行コマンド |
|------|------|-------------|
| ユニットテスト | `internal/**/*_test.go` | `make test-unit` |
| 統合テスト | `test/integration/` | `make test-integration` |
| E2E テスト | `test/e2e/` | `make test-e2e` |
| API テスト | `pkg/**/*_test.go` | `make test-api` |

## テスト命名規則

- テスト関数: `Test<対象>_<シナリオ>(t *testing.T)`
- サブテスト: `t.Run("<条件>/<期待結果>", ...)`
- テストケース ID: `I001`〜（パース統合）、`I010`〜（インポート解決）、`I020`〜（パイプライン）

## コーディング規約

- テーブル駆動テスト推奨
- `t.Helper()` でヘルパー関数をマーク
- `t.Parallel()` で並列実行可能なテストは並列化
- `-race` フラグ付きで全テスト実行
- テストヘルパーは `internal/testutil/` に集約

## 統合テスト (`test/integration/`)

- 複数の internal パッケージを結合してテスト
- エラーパスも網羅的にテスト
- テストケース ID を付与して追跡可能に

## E2E テスト (`test/e2e/`)

- `os/exec` で `pact` バイナリを実行
- 標準出力・標準エラー出力・exit code を検証
- 一時ディレクトリで実行し、テスト後にクリーンアップ
- `TestMain` でバイナリのビルドを事前実行

## テストデータ (`testdata/`)

- `.pact` ファイルのみ配置
- ファイル名で用途が分かるようにする
- テストデータはできるだけ小さく保つ

## 禁止事項

- テストデータへのハードコードされた絶対パス
- テスト間の依存（各テストは独立して実行可能にする）
- 外部サービスへの依存（ネットワーク接続等）
- テスト結果のファイルシステムへの永続的な書き込み
